(()=>{var e={};e.id=297,e.ids=[297],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},29021:e=>{"use strict";e.exports=require("fs")},33873:e=>{"use strict";e.exports=require("path")},71115:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var n=r(70260),o=r(28203),s=r(25155),a=r.n(s),i=r(67292),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let c=["",{children:["composer",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,75674)),"/Users/roykolak/Projects/moonclock/src/app/composer/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,71354)),"/Users/roykolak/Projects/moonclock/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"]}],d=["/Users/roykolak/Projects/moonclock/src/app/composer/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/composer/page",pathname:"/composer",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},38670:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"400458691e5f39ddafa4bd0a14caf9150ec26e7e41":()=>i});var n=r(21590);r(70376);var o=r(29021),s=r.n(o),a=r(68726);async function i({name:e,coordinates:t}){let r=`${(0,a.gx)()}/${e}.json`;s().writeFileSync(r,JSON.stringify(t,null,2))}(0,r(99344).D)([i]),(0,n.A)(i,"400458691e5f39ddafa4bd0a14caf9150ec26e7e41",null)},3191:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"003cea0d5ad419b7db89820aea65799cf884b0983f":()=>n.V8,"00778c6ed4a46b3cc6deb54d95f46a80fe20e8653b":()=>n.zn,"007c97be3c926b2f0462d6d909c13ece0073520f76":()=>n.cR});var n=r(41824)},87131:(e,t,r)=>{Promise.resolve().then(r.bind(r,46648)),Promise.resolve().then(r.bind(r,31978))},63571:(e,t,r)=>{Promise.resolve().then(r.bind(r,56572)),Promise.resolve().then(r.bind(r,77601))},56572:(e,t,r)=>{"use strict";r.d(t,{default:()=>y});var n=r(45512),o=r(40528),s=r(62148),a=r(78954),i=r(48376),l=r(23726),c=r(15436),d=r(52669),u=r(28500),p=r(11526),x=r(33563),h=r(36857),m=r(81346),f=r(45869),v=r(28531),b=r.n(v),j=r(79334),g=r(71709);let y=function({children:e}){let[t,{toggle:r}]=(0,u.useDisclosure)(),v=(0,j.usePathname)();return(0,n.jsxs)(o.AppShell,{header:{height:60},navbar:{width:300,breakpoint:"sm",collapsed:{mobile:!t}},padding:"md",children:[(0,n.jsx)(o.AppShell.Header,{children:(0,n.jsxs)(s.Group,{align:"center",h:"100%",px:"md",children:[(0,n.jsx)(a.Burger,{opened:t,onClick:r,hiddenFrom:"sm",size:"sm","data-testid":"app-menu"}),(0,n.jsx)(i.Text,{flex:1,children:"Moon Clock"})]})}),(0,n.jsxs)(o.AppShell.Navbar,{p:"md",children:[(0,n.jsx)(l.NavLink,{component:b(),href:"/",label:"Panel",active:v.includes("/panel"),leftSection:(0,n.jsx)(c.ActionIcon,{variant:"light",children:(0,n.jsx)(p.A,{style:{width:"70%",height:"70%"},stroke:1.5})})}),(0,n.jsx)(l.NavLink,{component:b(),href:"/presets",label:"Presets","data-testid":"nav-presets",active:v.includes("/presets"),leftSection:(0,n.jsx)(c.ActionIcon,{variant:"light",children:(0,n.jsx)(x.A,{style:{width:"70%",height:"70%"},stroke:1.5})})}),(0,n.jsx)(l.NavLink,{component:b(),href:"/composer",label:"Composer",active:v.includes("/composer"),leftSection:(0,n.jsx)(c.ActionIcon,{variant:"light",children:(0,n.jsx)(h.A,{style:{width:"70%",height:"70%"},stroke:1.5})})}),(0,n.jsx)(l.NavLink,{component:b(),href:"/settings",label:"Settings",active:v.includes("/settings"),leftSection:(0,n.jsx)(c.ActionIcon,{variant:"light",children:(0,n.jsx)(m.A,{style:{width:"70%",height:"70%"},stroke:1.5})})})]}),(0,n.jsx)(o.AppShell.Main,{children:(0,n.jsx)(g.tH,{fallbackRender:({error:e})=>(console.log(e.stack),(0,n.jsx)(d.Alert,{title:"There was a problem!",color:"red",icon:(0,n.jsx)(f.A,{}),children:e.message})),children:e})})]})}},77601:(e,t,r)=>{"use strict";r.d(t,{Editor:()=>C});var n=r(45512),o=r(58009),s=r(62148),a=r(15166),i=r(31824),l=r(63938),c=r(74164),d=r(388),u=r(9182),p=r(66816),x=r(52669),h=r(18870),m=r(28500),f=r(55705);function v({children:e,opacity:t}){return(0,n.jsx)("div",{style:{opacity:t,textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center"},children:e})}function b({y:e,x:t,children:r}){return(0,n.jsx)("div",{style:{width:20,textAlign:"center",display:"inline-flex",alignItems:"center",justifyContent:"center",aspectRatio:"1/1"},children:r},`row_${e}_col_${t}`)}function j({y:e,x:t,onClick:r,onMouseOver:o,matrix:s,showGrid:a}){return(0,n.jsx)("div",{"data-coordinates":`${t}:${e}`,onClick:r,onMouseOver:o,"data-testid":`dot-${t}-${e}`,style:{backgroundColor:s[`${t}:${e}`]||"#000",height:"90%",width:"90%",display:"inline-block",borderRadius:3,boxShadow:"1px 1px 1px #333",border:a&&(15===t||15===e)?"1px solid #aaa":"none"}})}function g({activeColor:e,matrix:t,setMatrix:r,showGrid:s}){let a=(0,o.useRef)(null),[i,l]=(0,o.useState)(!1);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{ref:a,style:{background:"#000",position:"relative",touchAction:"none"},onMouseDown:()=>l(!0),onMouseUp:()=>l(!1),onTouchMove:n=>{let o=n.touches[0],s=document.elementFromPoint(o.clientX,o.clientY),{coordinates:a}=s?.dataset;a&&r({...t,[a]:e})},children:(0,n.jsx)("div",{style:{zIndex:1,position:"relative"},children:[...Array(32).keys()].map(o=>(0,n.jsx)(v,{y:o,opacity:1,children:[...Array(32).keys()].map(a=>(0,n.jsx)(b,{y:o,x:a,children:(0,n.jsx)(j,{y:o,x:a,matrix:t,onClick:()=>{r({...t,[`${a}:${o}`]:e})},showGrid:s,onMouseOver:()=>{i&&r({...t,[`${a}:${o}`]:e})}})},`row_${o}_col_${a}`))},`row_${o}`))})})})}var y=r(26248);let k=(0,y.createServerReference)("400458691e5f39ddafa4bd0a14caf9150ec26e7e41",y.callServer,void 0,y.findSourceMapURL,"updateCustomSceneData");function S({color:e,setActiveColor:t,activeColor:r,index:o}){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{style:{width:"25px",height:"25px",background:e||"#000",border:e===r?"2px solid red":"none"},"data-testid":`color-${o}`,onClick:()=>t(e)})})}let w=["#89CFF0","#facc0d"];function A({activeColor:e,setActiveColor:t,matrix:r}){let[i,l]=(0,o.useState)(w);return(0,o.useEffect)(()=>{let e=new Set;for(let t in r)e.add(r[t]);l([...w,...e])},[JSON.stringify(r)]),(0,n.jsxs)(s.Group,{justify:"space-between",w:"100%",children:[(0,n.jsx)(s.Group,{gap:0,children:i.map((r,o)=>(0,n.jsx)(S,{color:r,setActiveColor:t,activeColor:e,index:o},`${o}-${r}`))}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),l([...i,e.target.elements.new_color.value])},children:(0,n.jsxs)(s.Group,{gap:"xs",children:[(0,n.jsx)("input",{type:"color",name:"new_color"}),(0,n.jsx)(a.Button,{type:"submit",size:"compact-sm",variant:"light",children:"Add"})]})})]})}function C({customScenes:e}){let[t,r]=(0,o.useState)(e[0]),[v,b]=(0,o.useState)(!1),[j,y]=(0,o.useState)(null),[S,w]=(0,o.useState)({}),[C,P]=(0,o.useState)(""),[_,{open:$,close:T}]=(0,m.useDisclosure)(),E=(0,f.m)({mode:"uncontrolled",initialValues:{name:""}});return(0,n.jsxs)(i.Stack,{children:[(0,n.jsx)(l.Select,{placeholder:"Select a scene...",variant:"filled",style:{flex:1},value:t?.name,"data-testid":"edit-scene-select",data:[{label:"New scene",value:"new-scene"},...e?.map(({name:e})=>({label:e,value:e}))],onChange:t=>{if("new-scene"===t)return $();let n=e.find(({name:e})=>e===t);n&&r(n)}}),(0,n.jsx)(c.Modal,{title:"New scene",opened:_,onClose:T,children:(0,n.jsxs)("form",{onSubmit:E.onSubmit(async({name:e})=>{let t={name:e,coordinates:{}};await k(t),r(t),T()}),children:[(0,n.jsx)(d.TextInput,{label:"Scene Name","data-testid":"new-scene-name",...E.getInputProps("name")},E.key("name")),(0,n.jsx)(s.Group,{justify:"flex-end",mt:"md",children:(0,n.jsx)(a.Button,{type:"submit",children:"Create"})})]})}),S&&t&&(0,n.jsxs)(u.Tabs,{defaultValue:"editor",variant:"outline",onChange:e=>{"raw-data"===e&&P(JSON.stringify(S,null,2))},children:[(0,n.jsxs)(u.Tabs.List,{mb:"md",children:[(0,n.jsx)(u.Tabs.Tab,{value:"editor","data-testid":"editor-tab",children:"Editor"}),(0,n.jsx)(u.Tabs.Tab,{value:"raw-data","data-testid":"raw-data-tab",children:"Raw Data"})]}),(0,n.jsx)(u.Tabs.Panel,{value:"editor",children:(0,n.jsxs)(i.Stack,{children:[(0,n.jsx)(A,{activeColor:j,setActiveColor:y,matrix:S}),(0,n.jsx)(g,{activeColor:j,matrix:S,setMatrix:w,showGrid:v}),(0,n.jsx)(p.Checkbox,{checked:v,onChange:()=>b(e=>!e),label:"Show grid lines"}),(0,n.jsx)(a.Button,{onClick:()=>{k({name:t.name,coordinates:S})},children:"Save Scene"})]})}),(0,n.jsxs)(u.Tabs.Panel,{value:"raw-data",children:[(0,n.jsx)(x.Alert,{variant:"light",color:"red",my:"sm",children:"Raw Data Mode is only useful for importing or exporting scene data... Be careful!"}),(0,n.jsx)(h.Textarea,{"data-testid":"raw-data-textarea",value:C,onChange:e=>{let{value:t}=e.currentTarget;P(t)},rows:20}),(0,n.jsx)(a.Button,{mt:"md",fullWidth:!0,onClick:()=>{try{let e=JSON.parse(C);w(e),k({name:t.name,coordinates:e})}catch(e){alert(e)}},children:"Save Scene"})]})]})]})}},75674:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l,dynamic:()=>i});var n=r(62740),o=r(41824),s=r(46648),a=r(31978);let i="force-dynamic";async function l(){let e=await (0,o.zn)();return(0,n.jsx)(s.default,{children:(0,n.jsx)(a.Editor,{customScenes:e})})}},46648:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});let n=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/roykolak/Projects/moonclock/src/components/App.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/roykolak/Projects/moonclock/src/components/App.tsx","default")},31978:(e,t,r)=>{"use strict";r.d(t,{Editor:()=>n});let n=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call Editor() from the server but Editor is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/roykolak/Projects/moonclock/src/components/Editor.tsx","Editor")},41824:(e,t,r)=>{"use strict";r.d(t,{V8:()=>i,cR:()=>l,zn:()=>c});var n=r(88977);r(98063);var o=r(29021),s=r.n(o),a=r(28081);async function i(){try{return s().readFileSync((0,a.rV)()).toString()}catch{return null}}async function l(){return s().readdirSync((0,a.gx)()).map(e=>e.split(".")[0])}async function c(){return s().readdirSync((0,a.gx)()).map(e=>{let t=e.split(".")[0],r=JSON.parse(s().readFileSync(`${(0,a.gx)()}/${t}.json`).toString());return{name:t,coordinates:r}})}(0,r(56215).D)([i,l,c]),(0,n.A)(i,"003cea0d5ad419b7db89820aea65799cf884b0983f",null),(0,n.A)(l,"007c97be3c926b2f0462d6d909c13ece0073520f76",null),(0,n.A)(c,"00778c6ed4a46b3cc6deb54d95f46a80fe20e8653b",null)},68726:(e,t,r)=>{"use strict";r.d(t,{G3:()=>i,gx:()=>s,rV:()=>a,yY:()=>o});var n=r(79646);function o(){console.log("[APP] Triggering hardware restart"),(0,n.exec)("systemctl restart moonclock-hardware")}function s(){return"/var/lib/moonclock/custom_scenes"}function a(){return"/var/lib/moonclock/lastHeartbeat.txt"}function i(){return"/var/lib/moonclock/database.json"}},28081:(e,t,r)=>{"use strict";function n(){return"/var/lib/moonclock/custom_scenes"}function o(){return"/var/lib/moonclock/lastHeartbeat.txt"}function s(){return"/var/lib/moonclock/database.json"}r.d(t,{G3:()=>s,gx:()=>n,rV:()=>o}),r(79646)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[281,700,801,912],()=>r(71115));module.exports=n})();