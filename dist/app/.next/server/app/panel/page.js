(()=>{var e={};e.id=307,e.ids=[307],e.modules={88044:e=>{"use strict";e.exports=require("canvas")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},29021:e=>{"use strict";e.exports=require("fs")},33873:e=>{"use strict";e.exports=require("path")},23245:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>l});var r=n(70260),s=n(28203),a=n(25155),i=n.n(a),o=n(67292),d={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);n.d(t,d);let l=["",{children:["panel",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,59184)),"/Users/roykolak/Projects/moonclock/src/app/panel/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(n.bind(n,71354)),"/Users/roykolak/Projects/moonclock/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(n.t.bind(n,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(n.t.bind(n,41485,23)),"next/dist/client/components/unauthorized-error"]}],c=["/Users/roykolak/Projects/moonclock/src/app/panel/page.tsx"],u={require:n,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/panel/page",pathname:"/panel",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},8952:(e,t,n)=>{"use strict";n.r(t),n.d(t,{"00b4386ce128d64c5ecaa17c1c96fbdbb563f32945":()=>p,"40168ccf985765a66f490fa30acd367eac1649488d":()=>r.q,"401ee6b40e8f6474624a6b1ff29f136c70c6c52570":()=>l,"40b489463ab873e83127c3b28516101d990c7cebee":()=>u,"40bd3bc60077c82b69f4c98abb2acc7764cd695476":()=>c});var r=n(51170),s=n(21590);n(70376);var a=n(47735),i=n(63601),o=n(67296),d=n(99344);async function l(e){(0,i.XO)({scheduledPreset:{updatedAt:new Date().toJSON(),preset:null,endTime:null,...e}}),(0,a.revalidatePath)("/panel")}async function c(e){let{scheduledPreset:t}=await (0,i.bQ)();if(!t)return(0,a.revalidatePath)("/panel");if(null===t.endTime)return;let n=new Date(t.endTime);n.setMinutes(n.getMinutes()+e),await (0,i.XO)({scheduledPreset:{...t,endTime:n.toJSON(),updatedAt:new Date().toJSON()}}),(0,a.revalidatePath)("/panel")}async function u(e){let t=(0,o.W)(e);(0,i.XO)({scheduledPreset:{preset:{...e,name:"Custom"},endTime:t?t.toJSON():null,updatedAt:new Date().toJSON()}}),(0,a.revalidatePath)("/panel")}(0,d.D)([l,c,u]),(0,s.A)(l,"401ee6b40e8f6474624a6b1ff29f136c70c6c52570",null),(0,s.A)(c,"40bd3bc60077c82b69f4c98abb2acc7764cd695476",null),(0,s.A)(u,"40b489463ab873e83127c3b28516101d990c7cebee",null);var m=n(84384);async function p(){await (0,i.XO)({hardware:{preset:{name:"Trigger Hardware Reload",scenes:[{sceneName:m.iT,sceneConfig:{}}],mode:"for",untilDay:"0",untilHour:"0",untilMinute:"00",forTime:"0:00"}}}),(0,a.revalidatePath)("/panel")}(0,d.D)([p]),(0,s.A)(p,"00b4386ce128d64c5ecaa17c1c96fbdbb563f32945",null)},55263:(e,t,n)=>{"use strict";n.r(t),n.d(t,{"002aa21eceb7baff33c3b3104dca68851f89d867a1":()=>r.cR,"008fc986eaf43402eb796d17541d6759aa1c9a465b":()=>r.zn,"00b2b40489db12b9391a83fce66626def34a041379":()=>r.V8});var r=n(41824)},28158:(e,t,n)=>{Promise.resolve().then(n.bind(n,46648)),Promise.resolve().then(n.bind(n,15535))},19910:(e,t,n)=>{Promise.resolve().then(n.bind(n,56572)),Promise.resolve().then(n.bind(n,57794))},57794:(e,t,n)=>{"use strict";n.d(t,{default:()=>N});var r=n(45512),s=n(74164),a=n(44914),i=n(62148),o=n(48376),d=n(23464),l=n(15436),c=n(31824),u=n(15166),m=n(27521),p=n(89465),f=n(7423),h=n(79692),x=n(29571),b=n(45900),j=n(28500),g=n(72590),v=n(26248);let w=(0,v.createServerReference)("40b489463ab873e83127c3b28516101d990c7cebee",v.callServer,void 0,v.findSourceMapURL,"createCustomScheduledPreset"),y=(0,v.createServerReference)("401ee6b40e8f6474624a6b1ff29f136c70c6c52570",v.callServer,void 0,v.findSourceMapURL,"updateScheduledPreset"),P=(0,v.createServerReference)("40bd3bc60077c82b69f4c98abb2acc7764cd695476",v.callServer,void 0,v.findSourceMapURL,"changeEndTime");var S=n(15992),k=n(27240);function C({hardwarePreset:e,formattedLastHeartbeat:t,formattedHardwareRenderedAt:n}){return(0,r.jsx)(S.Accordion,{defaultValue:"Apples",variant:"filled",mt:"xs",children:(0,r.jsxs)(S.Accordion.Item,{value:"hardware",children:[(0,r.jsx)(S.Accordion.Control,{children:(0,r.jsx)(o.Text,{size:"sm",c:"dimmed",children:"Hardware Details"})}),(0,r.jsx)(S.Accordion.Panel,{children:(0,r.jsx)(c.Stack,{children:(0,r.jsxs)(k.Grid,{gutter:0,children:[(0,r.jsx)(k.Grid.Col,{span:4,children:(0,r.jsx)(o.Text,{c:"dimmed",size:"sm",fw:"bold",children:"Scene:"})}),(0,r.jsx)(k.Grid.Col,{span:8,children:(0,r.jsxs)(o.Text,{c:"dimmed",size:"sm",children:[e.scenes[0].sceneName," scene"]})}),(0,r.jsx)(k.Grid.Col,{span:4,children:(0,r.jsx)(o.Text,{c:"dimmed",size:"sm",fw:"bold",children:"Rendered at:"})}),(0,r.jsx)(k.Grid.Col,{span:8,children:(0,r.jsx)(o.Text,{c:"dimmed",size:"sm",children:n})}),(0,r.jsx)(k.Grid.Col,{span:4,children:(0,r.jsx)(o.Text,{c:"dimmed",size:"sm",mb:"xs",fw:"bold",children:"Last loop run:"})}),(0,r.jsx)(k.Grid.Col,{span:8,children:(0,r.jsx)(o.Text,{c:"dimmed",size:"sm",mb:"xs",children:t})})]})})})]},"hardware")})}var T=(0,n(74774).A)("outline","dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);let M=(0,v.createServerReference)("00b4386ce128d64c5ecaa17c1c96fbdbb563f32945",v.callServer,void 0,v.findSourceMapURL,"reloadHardwareScene");var A=n(99553);function D(e){let t=Math.abs(e);return`${e>0?"+":"-"}${t<60?t:t/60} ${t<60?"min":"hour"}`}function N({panel:e,hardwarePreset:t,scheduledPreset:n,formattedEndTime:v,formattedLastHeartbeat:S,formattedHardwareRenderedAt:k,presets:N,customSceneNames:H}){let[R,O]=(0,j.useDisclosure)(),_=parseInt(n?.preset?.[x.M8.TimeAdjustmentAmount]||e.timeAdjustmentAmount,10);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Modal,{opened:R,title:"Set custom preset",onClose:O.close,children:(0,r.jsx)(g.PresetForm,{customSceneNames:H,preset:{name:"Custom Preset"},action:async e=>{await w(e),O.close()},submitLabel:"Apply now"})}),(0,r.jsxs)(a.Card,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,style:{maxWidth:500},children:[(0,r.jsx)(a.Card.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:(0,r.jsxs)(i.Group,{justify:"space-between",children:[(0,r.jsx)(o.Text,{fw:700,"data-testid":"panel-name",children:e.name}),(0,r.jsxs)(d.Menu,{withinPortal:!0,position:"bottom-end",shadow:"sm",children:[(0,r.jsx)(d.Menu.Target,{children:(0,r.jsx)(l.ActionIcon,{variant:"subtle",color:"gray","data-testid":"panel-menu",children:(0,r.jsx)(T,{size:16})})}),(0,r.jsxs)(d.Menu.Dropdown,{children:[(0,r.jsx)(d.Menu.Item,{disabled:!n?.preset,onClick:()=>{y({preset:null,endTime:null})},children:"Clear Scene"}),(0,r.jsx)(d.Menu.Item,{onClick:async()=>{(0,A.showNotification)({message:"Hardware Scene reloading..."}),await M()},children:"Reload Hardware"})]})]})]})}),(0,r.jsxs)(a.Card.Section,{children:[(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)(b.K,{preset:n?.preset||e.defaultPreset,isDefaultPreset:!n?.preset}),!n?.preset&&(0,r.jsxs)(c.Stack,{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:[N.map((e,t)=>(0,r.jsx)(u.Button,{variant:"filled",fullWidth:!0,onClick:()=>{let t=function(e){let t=new Date;if("until"===e.mode){let n=parseInt(e.untilDay,10),r=parseInt(e.untilHour,10),s=parseInt(e.untilMinute,10);t.setDate(t.getDate()+n),t.setHours(r,s,0,0)}else if("for"===e.mode){let[n,r]=e.forTime.split(":"),s=parseInt(n,10),a=parseInt(r,10);if(0===s&&0===a)return null;t.setHours(t.getHours()+s,t.getMinutes()+a,0,0)}return t}(e);y({preset:e,endTime:t?.toJSON()||null})},children:e.name},`preset-${t}`)),(0,r.jsx)(u.Button,{variant:"light",fullWidth:!0,onClick:O.open,children:"Custom..."})]})]}),n?.preset&&(0,r.jsxs)(m.Flex,{p:"lg",children:[(0,r.jsx)(p.Box,{children:(0,r.jsxs)(c.Stack,{gap:4,children:[(0,r.jsx)(f.Center,{children:(0,r.jsxs)(o.Text,{children:[n.preset.name," until..."]})}),(0,r.jsx)(h.Badge,{color:"gray",radius:"sm",style:{height:50,padding:"8px 16px",fontSize:38,lineHeight:38},styles:{label:{color:"#CCC"}},"data-testid":"end-time",children:v})]})}),(0,r.jsx)(p.Box,{flex:"auto"}),(0,r.jsx)(m.Flex,{gap:"lg",children:(0,r.jsxs)(c.Stack,{gap:8,children:[(0,r.jsx)(u.Button,{variant:"filled",disabled:null===n.endTime,onClick:()=>{P(_)},children:D(_)}),(0,r.jsx)(u.Button,{variant:"filled",disabled:null===n.endTime,onClick:()=>P(-_),children:D(-_)})]})})]})]})]}),(0,r.jsx)(C,{hardwarePreset:t,formattedLastHeartbeat:S,formattedHardwareRenderedAt:k})]})}},59184:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c,dynamic:()=>d,generateMetadata:()=>l});var r=n(62740),s=n(46648),a=n(41824),i=n(15535),o=n(20304);let d="force-dynamic";async function l(){let{panel:e}=(0,o.bQ)();return{title:e.name}}async function c(){let{scheduledPreset:e,panel:t,presets:n,hardware:d}=(0,o.bQ)(),l=await (0,a.V8)(),c=await (0,a.cR)(),u=null,m=null,p=null;return e&&(u=e.endTime?new Date(e.endTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):"forever"),l&&(m=new Date(l).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",second:"2-digit"})),d.renderedAt&&(p=new Date(d.renderedAt).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",second:"2-digit"})),(0,r.jsx)(s.default,{children:(0,r.jsx)(i.default,{panel:t,scheduledPreset:e,hardwarePreset:d.preset,formattedEndTime:u,formattedLastHeartbeat:m,formattedHardwareRenderedAt:p,presets:n,customSceneNames:c})})}},15535:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});let r=(0,n(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/roykolak/Projects/moonclock/src/components/Panel.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/roykolak/Projects/moonclock/src/components/Panel.tsx","default")},63601:(e,t,n)=>{"use strict";n.d(t,{XO:()=>u,bQ:()=>c});var r=n(29021),s=n.n(r),a=n(84384);let i={name:"Default",scenes:[{sceneName:a.eU.Blank,sceneConfig:{}}],mode:"for",untilDay:"0",untilHour:"0",untilMinute:"00",forTime:"0:00"},o={panel:{name:"My Moonclock",timeAdjustmentAmount:"5",defaultPreset:i,brightness:30,pwnLsbNanoseconds:130,gpioSlowdown:4,pwmBits:11},scheduledPreset:{preset:null,endTime:null},hardware:{preset:i},presets:[{name:"Sleep Mode",scenes:[{sceneName:a.eU.Moon,sceneConfig:{}}],mode:"until",untilDay:"1",untilHour:"7",untilMinute:"00",forTime:""},{name:"Nap Mode",scenes:[{sceneName:"bunny",sceneConfig:{}}],mode:"for",untilDay:"0",untilHour:"0",untilMinute:"0",forTime:"2:00"},{name:"Timeout",scenes:[{sceneName:a.eU.Countdown,sceneConfig:{}}],mode:"for",untilDay:"0",untilHour:"0",untilMinute:"0",forTime:"0:05"}]};function d(){return"test"===process.env.APP_ENV?"database-test.json":"database.json"}function l(){let e=d();try{let t=s().readFileSync(`./${e}`).toString();return JSON.parse(t)}catch{return console.log(`${e} not found, loading default data`),JSON.parse(JSON.stringify(o))}}function c(){return l()}function u(e){var t;t={...l(),...e},s().writeFileSync(d(),JSON.stringify(t,null,2),{mode:510})}},99985:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var r=(0,n(74774).A)("outline","settings","IconSettings",[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]])}};var t=require("../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[281,700,801,735,912,188,521],()=>n(23245));module.exports=r})();